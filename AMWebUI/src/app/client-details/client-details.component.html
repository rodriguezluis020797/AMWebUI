<!-- Show detailed note -->
<am-client-note-details *ngIf="selectedClientNote && !loading" [clientNoteDto]="selectedClientNote"
    (back)="goBackToClient()"></am-client-note-details>

<!-- Main client container -->
<div *ngIf="!selectedClientNote && !loading" class="client-container">

    <!-- Add Note Form -->
    <div *ngIf="addClientNote">
        <label for="note">Note</label>
        <textarea id="note" [(ngModel)]="clientNoteToAdd.note" rows="5" cols="40"></textarea>
        <br />
        <button (click)="saveNote()">Save</button>
        <button (click)="cancelNote()">Cancel</button>
    </div>

    <!-- Client View / Edit -->
    <div *ngIf="!addClientNote">
        <!-- View Mode -->
        <ng-container *ngIf="!editClient; else editClientTemplate">
            <button (click)="goBackToClientList()">Back to List</button>
            <br /><br />
            <h3>
                {{ clientDto.firstName }}
                <ng-container *ngIf="clientDto.middleName">{{ clientDto.middleName + ' ' }}</ng-container>
                {{ clientDto.lastName }}
            </h3>
            <p><strong>Phone:</strong> {{ clientDto.phoneNumber }}</p>

            <button (click)="editClientFunc()">Edit</button>
            <button (click)="addNote()">Add Note</button>

            <br /><br />
            <div *ngIf="clientNotes.length === 0">
                <h2>No client notes</h2>
            </div>

            <div *ngIf="clientNotes.length > 0">
                <h2>Notes</h2>
                <div *ngFor="let note of clientNotes; trackBy: trackByNoteId" class="client-item">
                    <h3>
                        {{ note.createDate }}
                        <ng-container *ngIf="note.updateDate"> - Updated: {{ note.updateDate }}</ng-container>
                    </h3>
                    <p>{{ note.note }}</p>
                    <button (click)="editNote(note)">View</button>
                </div>
            </div>
        </ng-container>

        <!-- Edit Mode Template -->
        <ng-template #editClientTemplate>
            <div *ngIf="clientEditDto.errorMessage" class="error-message">
                <p>{{ clientEditDto.errorMessage }}</p>
            </div>

            <label for="firstName">First Name</label>
            <input id="firstName" [(ngModel)]="clientEditDto.firstName" />

            <label for="middleName">Middle Name</label>
            <input id="middleName" [(ngModel)]="clientEditDto.middleName" />

            <label for="lastName">Last Name</label>
            <input id="lastName" [(ngModel)]="clientEditDto.lastName" />

            <label for="phone">Phone Number</label>
            <input id="phone" [(ngModel)]="clientEditDto.phoneNumber" />

            <br />
            <button (click)="saveClient()">Save</button>
            <button (click)="cancelEditClient()">Cancel</button>
            <button (click)="deleteClient()">Delete</button>
        </ng-template>
    </div>

    <!-- Delete Confirmation Modal -->
    <am-delete-entity *ngIf="showDeleteModal && !loading" [header]="'Delete Client'"
        [message]="'Are you sure you want to delete this client?'"
        (confirm)="onConfirmDelete($event)"></am-delete-entity>
</div>

<!-- Loading Screen -->
<div *ngIf="loading">
    <am-loading-screen></am-loading-screen>
</div>