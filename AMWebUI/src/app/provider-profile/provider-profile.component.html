<div *ngIf="!loading" class="provider-container">
  <h1 *ngIf="!editProvider">Details</h1>
  <h1 *ngIf="editProvider">Edit Details</h1>

  <div *ngIf="editDTO.errorMessage && editProvider" class="error-message">
    <p>{{ editDTO.errorMessage }}</p>
  </div>

  <!-- Display Mode -->
  <div *ngIf="!editProvider">
    <h2>Personal Details</h2>
    <div><strong>Business Name:</strong> {{ dto.businessName }}</div>
    <div><strong>First Name:</strong> {{ dto.firstName }}</div>
    <div><strong>Middle Name:</strong> {{ dto.middleName || "—" }}</div>
    <div><strong>Last Name:</strong> {{ dto.lastName }}</div>
    <div><strong>E-Mail:</strong> {{ dto.eMail }}</div>
    <div><strong>Address Line 1:</strong> {{ dto.addressLine1 }}</div>
    <div><strong>Address Line 2:</strong> {{ dto.addressLine2 || "—" }}</div>
    <div><strong>City:</strong> {{ dto.city }}</div>
    <div><strong>Zip Code:</strong> {{ dto.zipCode }}</div>
    <div>
      <strong>Country:</strong>
      {{ getEnumLabel(CountryCodeEnum, dto.countryCode) }}
    </div>
    <div>
      <strong>State:</strong> {{ getEnumLabel(StateCodeEnum, dto.stateCode) }}
    </div>
    <div>
      <strong>Time Zone:</strong>
      {{ getEnumLabel(TimeZoneCodeEnum, dto.timeZoneCode) }}
    </div>
    <button (click)="edit()">Edit</button>
    <a [href]="dto.payEngineInfoUrl" target="_blank" rel="noopener noreferrer">Edit Payment Method or View
      Invoices</a>
    <br>
    <br>

    <p *ngIf="dto.subscriptionToBeCancelled == false">
      <strong>Next Billing Date</strong>: {{ dto.nextBillingDate | date:'MM/dd/yyyy' }}
    </p>
    <a *ngIf="dto.subscriptionToBeCancelled == false" (click)="cancelSubscription()">Cancel Subscription</a>
    <p *ngIf="dto.subscriptionToBeCancelled == true && dto.errorMessage != ''">
      {{dto.errorMessage}}
    </p>

    <p *ngIf="dto.subscriptionToBeCancelled == true">
      <strong>Cancellation Date</strong>: {{ dto.nextBillingDate | date:'MM/dd/yyyy' }}
    </p>
    <a *ngIf="dto.subscriptionToBeCancelled == true" (click)="reActivateSubscription()">Reactivate Service</a>
  </div>

  <!-- Edit Mode -->
  <div *ngIf="editProvider">
    <label for="businessName">Business Name:</label>
    <input type="text" id="businessName" [(ngModel)]="editDTO.businessName" name="businessName" required />
    <label for="firstName">First Name:</label>
    <input type="text" id="firstName" [(ngModel)]="editDTO.firstName" name="firstName" required />
    <label for="middleName">Middle Name:</label>
    <input type="text" id="middleName" [(ngModel)]="editDTO.middleName" name="middleName" required />
    <label for="lastName">Last Name:</label>
    <input type="text" id="lastName" [(ngModel)]="editDTO.lastName" name="lastName" required />
    <p>Address used only for billing and tax purposes.</p>
    <label for="addressLine1">Address Line 1:</label>
    <input type="text" id="addressLine1" [(ngModel)]="editDTO.addressLine1" name="addressLine1" required />
    <label for="addressLine2">Address Line 2:</label>
    <input type="text" id="addressLine2" [(ngModel)]="editDTO.addressLine2" name="addressLine2" required />
    <label for="city">City:</label>
    <input type="text" id="city" [(ngModel)]="editDTO.city" name="city" required />
    <label for="zipCode">Zip Code:</label>
    <input type="text" id="zipCode" [(ngModel)]="editDTO.zipCode" name="zipCode" required />

    <label for="countryDropdown">Country:</label>
    <select [(ngModel)]="editDTO.countryCode" (change)="onCountryChange()" name="countryCode">
      <option *ngFor="let opt of countryCodeOptions" [value]="opt.key">
        {{ opt.label }}
      </option>
    </select>

    <label for="stateDropdown">State:</label>
    <select [(ngModel)]="editDTO.stateCode" name="stateCode" id="stateDropdown">
      <option *ngFor="let opt of stateOptions" [value]="opt.key">
        {{ getEditLabel(opt.label) }}
      </option>
    </select>

    <label for="stateDropdown">Time Zone:</label>
    <select [(ngModel)]="editDTO.timeZoneCode">
      <option *ngFor="let option of timeZoneOptions" [value]="option.key">
        {{ option.label }}
      </option>
    </select>

    <a routerLink="/reset-email">Update E-Mail</a>
    <a routerLink="/update-password">Update Password</a>
    <br />
    <button (click)="editSave()">Save</button>
    <button *ngIf="!disableCancel" (click)="cancelEdit()">Cancel</button>
  </div>
</div>

<am-delete-entity *ngIf="showDeleteModal && !loading" [header]="'Cancel Subsciption'"
  [message]="'You’ll keep access through your current billing period. Any messages set to go out afterward won’t be delivered unless you reactivate in time.'"
  (confirm)="onCancelSubscription($event)">
</am-delete-entity>

<am-delete-entity *ngIf="showReSubscribeModal && !loading" [header]="'Reactivate Subsciption'"
  [message]="'Your subscription will be reactivated right away. If your last billing cycle has ended, your default payment method will be charged automatically.'"
  (confirm)="onReActivateSubscription($event)">
</am-delete-entity>

<div *ngIf="loading">
  <am-loading-screen></am-loading-screen>
</div>