<ng-container *ngIf="!loading; else loadingScreen">
  <div class="provider-container">
    <h1>{{ editProvider ? 'Edit Details' : 'Details' }}</h1>

    <div *ngIf="editDTO.errorMessage && editProvider" class="error-message">
      <p>{{ editDTO.errorMessage }}</p>
    </div>

    <!-- Display Mode -->
    <ng-container *ngIf="!editProvider; else editMode">
      <h2>Personal Details</h2>
      <ng-container *ngFor="let field of [
        { label: 'Business Name', value: dto.businessName },
        { label: 'First Name', value: dto.firstName },
        { label: 'Middle Name', value: dto.middleName || '—' },
        { label: 'Last Name', value: dto.lastName },
        { label: 'E-Mail', value: dto.eMail },
        { label: 'Address Line 1', value: dto.addressLine1 },
        { label: 'Address Line 2', value: dto.addressLine2 || '—' },
        { label: 'City', value: dto.city },
        { label: 'Zip Code', value: dto.zipCode }
      ]">
        <div><strong>{{ field.label }}:</strong> {{ field.value }}</div>
      </ng-container>

      <div><strong>Country:</strong> {{ getEnumLabel(CountryCodeEnum, dto.countryCode) }}</div>
      <div><strong>State:</strong> {{ getEnumLabel(StateCodeEnum, dto.stateCode) }}</div>
      <div><strong>Time Zone:</strong> {{ getEnumLabel(TimeZoneCodeEnum, dto.timeZoneCode) }}</div>

      <button (click)="edit()">Edit</button>
      <a [href]="dto.payEngineInfoUrl" target="_blank" rel="noopener noreferrer">
        Edit Payment Method or View Invoices
      </a>

      <div *ngIf="!dto.subscriptionToBeCancelled">
        <p><strong>Next Billing Date:</strong> {{ dto.nextBillingDate | date: 'MM/dd/yyyy' }}</p>
        <a (click)="cancelSubscription()">Cancel Subscription</a>
      </div>

      <div *ngIf="dto.subscriptionToBeCancelled">
        <p *ngIf="dto.errorMessage">{{ dto.errorMessage }}</p>
        <p><strong>Cancellation Date:</strong> {{ dto.nextBillingDate | date: 'MM/dd/yyyy' }}</p>
        <a (click)="reActivateSubscription()">Reactivate Service</a>
      </div>
    </ng-container>

    <!-- Edit Mode -->
    <ng-template #editMode>
      <form>
        <div *ngFor="let input of [
          { id: 'businessName', label: 'Business Name', model: editDTO.businessName },
          { id: 'firstName', label: 'First Name', model: editDTO.firstName },
          { id: 'middleName', label: 'Middle Name', model: editDTO.middleName },
          { id: 'lastName', label: 'Last Name', model: editDTO.lastName },
          { id: 'addressLine1', label: 'Address Line 1', model: editDTO.addressLine1 },
          { id: 'addressLine2', label: 'Address Line 2', model: editDTO.addressLine2 },
          { id: 'city', label: 'City', model: editDTO.city },
          { id: 'zipCode', label: 'Zip Code', model: editDTO.zipCode }
        ]">
          <label [for]="input.id">{{ input.label }}:</label>
          <input type="text" [id]="input.id" [(ngModel)]="input.model" [name]="input.id" required />
        </div>

        <p>Address used only for billing and tax purposes.</p>

        <label>Country:</label>
        <select [(ngModel)]="editDTO.countryCode" name="countryCode" (change)="onCountryChange()">
          <option *ngFor="let opt of countryCodeOptions" [value]="opt.key">{{ opt.label }}</option>
        </select>

        <label>State:</label>
        <select [(ngModel)]="editDTO.stateCode" name="stateCode">
          <option *ngFor="let opt of stateOptions" [value]="opt.key">{{ getEditLabel(opt.label) }}</option>
        </select>

        <label>Time Zone:</label>
        <select [(ngModel)]="editDTO.timeZoneCode" name="timeZoneCode">
          <option *ngFor="let opt of timeZoneOptions" [value]="opt.key">{{ opt.label }}</option>
        </select>

        <a routerLink="/reset-email">Update E-Mail</a>
        <a routerLink="/update-password">Update Password</a>

        <button type="button" (click)="editSave()">Save</button>
        <button type="button" *ngIf="!disableCancel" (click)="cancelEdit()">Cancel</button>
      </form>
    </ng-template>
  </div>

  <!-- Modals -->
  <am-delete-entity *ngIf="showDeleteModal" [header]="'Cancel Subscription'"
    [message]="'You’ll keep access through your current billing period. Any messages set to go out afterward won’t be delivered unless you reactivate in time.'"
    (confirm)="onCancelSubscription($event)">
  </am-delete-entity>

  <am-delete-entity *ngIf="showReSubscribeModal" [header]="'Reactivate Subscription'"
    [message]="'Your subscription will be reactivated right away. If your last billing cycle has ended, your default payment method will be charged automatically.'"
    (confirm)="onReActivateSubscription($event)">
  </am-delete-entity>
</ng-container>

<ng-template #loadingScreen>
  <am-loading-screen></am-loading-screen>
</ng-template>