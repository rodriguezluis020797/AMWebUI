<ng-container *ngIf="!passwordReset; else passwordResetFlow">
  <!-- Request Reset -->
  <div class="container py-4" style="max-width: 400px;" *ngIf="!loading && !success">
    <h2>Reset Password</h2>
    <div class="mb-3">
      <label for="username" class="form-label">E-Mail</label>
      <input type="text" id="username" [(ngModel)]="dto.eMail" name="username" class="form-control" required />
    </div>
    <div class="d-grid gap-2">
      <button type="submit" class="btn btn-primary" (click)="submit()">Reset</button>
      <a routerLink="/" class="text-center text-decoration-none">Cancel</a>
    </div>
  </div>

  <!-- Email Sent Message -->
  <div class="container py-4" style="max-width: 400px;" *ngIf="!loading && success">
    <h2>Reset Password</h2>
    <p class="alert alert-success">
      If an account is associated with this email, you will receive instructions on how to proceed.
    </p>
    <a routerLink="/" class="btn btn-outline-primary">Back To Login</a>
  </div>

  <!-- Loading Spinner -->
  <div class="container py-4" style="max-width: 400px;" *ngIf="loading && !success">
    <am-loading-screen></am-loading-screen>
  </div>
</ng-container>

<ng-template #passwordResetFlow>
  <!-- Password Reset Form -->
  <div class="container py-4" style="max-width: 400px;" *ngIf="!loading && !success">
    <h2>Reset Password</h2>

    <div class="alert alert-info">
      <strong>Password Requirements:</strong><br />
      At least <strong>8 characters</strong>, one <strong>uppercase</strong>, one <strong>lowercase</strong>,
      one <strong>number</strong>, and one <strong>special character</strong>
      (<code># % & * _ +</code>)
    </div>

    <div *ngIf="message" class="alert alert-danger">
      {{ message }}
    </div>

    <div class="mb-3">
      <label for="newPassword" class="form-label">New Password</label>
      <input type="password" id="newPassword" [(ngModel)]="dto.newPassword" name="newPassword" class="form-control"
        required />
    </div>

    <div class="mb-3">
      <label for="confirmPassword" class="form-label">Confirm New Password</label>
      <input type="password" id="confirmPassword" [(ngModel)]="confirmPassword" name="confirmPassword"
        class="form-control" required />
    </div>

    <div class="d-grid gap-2">
      <button type="submit" class="btn btn-primary" (click)="submitPasswordReset()">Reset Password</button>
      <a *ngIf="!dto.isTempPassword" routerLink="/" class="text-center text-decoration-none">Cancel</a>
    </div>
  </div>

  <!-- Success Message -->
  <div class="container py-4" style="max-width: 400px;" *ngIf="!loading && success">
    <h2>Reset Password</h2>
    <p class="alert alert-success">Password reset successfully. You can now log in.</p>
    <a routerLink="/" class="btn btn-outline-primary">Back To Login</a>
  </div>

  <!-- Loading Spinner -->
  <div class="container py-4" style="max-width: 400px;" *ngIf="loading && !success">
    <am-loading-screen></am-loading-screen>
  </div>
</ng-template>